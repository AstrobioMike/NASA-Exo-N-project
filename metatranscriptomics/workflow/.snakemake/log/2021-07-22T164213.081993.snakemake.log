Building DAG of jobs...
Conda environment envs/cat.yaml will be created.
Conda environment envs/trinity.yaml will be created.
Conda environment envs/mapping.yaml will be created.
Conda environment envs/kofamscan.yaml will be created.
Conda environment envs/prodigal.yaml will be created.
Conda environment envs/bit.yaml will be created.
Job stats:
job                                                   count    min threads    max threads
--------------------------------------------------  -------  -------------  -------------
all                                                       1              1              1
assembly                                                  2              1              1
bbduk                                                     4              1              1
build_bowtie2_index                                       2              1              1
call_genes                                                2              1              1
combine_all_gene_coverages_collapsed_by_KO_and_tax        1              1              1
combine_group_gene_coverage_annots_and_tax                2              1              1
filtered_fastqc                                           4              1              1
filtered_multiqc                                          1              1              1
get_cov_and_det                                           4              1              1
raw_fastqc                                                4              1              1
raw_multiqc                                               1              1              1
run_KO_annotation                                         2              1              1
run_mapping                                               4              1              1
run_tax_classification                                    2              1              1
setup_CAT_db                                              1              1              1
setup_KoFamScan_db                                        1              1              1
summarize_assemblies                                      1              1              1
total                                                    39              1              1


[Thu Jul 22 16:42:13 2021]
rule bbduk:
    input: ../sub-reads/R1_R1.fq.gz, ../sub-reads/R1_R2.fq.gz
    output: ../filtered-reads/R1-R1-trimmed.fq.gz, ../filtered-reads/R1-R2-trimmed.fq.gz
    log: logs/bbduk-R1.log
    jobid: 7
    wildcards: ID=R1
    resources: tmpdir=/tmp


        bbduk.sh in=../sub-reads/R1_R1.fq.gz in2=../sub-reads/R1_R2.fq.gz out1=../filtered-reads/R1-R1-trimmed.fq.gz out2=../filtered-reads/R1-R2-trimmed.fq.gz                 ref=${CONDA_PREFIX}/opt/bbmap-38.86-0/resources/adapters.fa ktrim=l k=17 ftm=5 qtrim=rl                 trimq=10 mlf=0.5 maxns=0 > logs/bbduk-R1.log 2>&1
        

[Thu Jul 22 16:42:13 2021]
rule bbduk:
    input: ../sub-reads/R5_R1.fq.gz, ../sub-reads/R5_R2.fq.gz
    output: ../filtered-reads/R5-R1-trimmed.fq.gz, ../filtered-reads/R5-R2-trimmed.fq.gz
    log: logs/bbduk-R5.log
    jobid: 21
    wildcards: ID=R5
    resources: tmpdir=/tmp


        bbduk.sh in=../sub-reads/R5_R1.fq.gz in2=../sub-reads/R5_R2.fq.gz out1=../filtered-reads/R5-R1-trimmed.fq.gz out2=../filtered-reads/R5-R2-trimmed.fq.gz                 ref=${CONDA_PREFIX}/opt/bbmap-38.86-0/resources/adapters.fa ktrim=l k=17 ftm=5 qtrim=rl                 trimq=10 mlf=0.5 maxns=0 > logs/bbduk-R5.log 2>&1
        

[Thu Jul 22 16:42:13 2021]
rule raw_fastqc:
    input: ../sub-reads/R1_R1.fq.gz, ../sub-reads/R1_R2.fq.gz
    output: ../sub-reads/R1_R1_fastqc.zip, ../sub-reads/R1_R2_fastqc.zip
    jobid: 30
    wildcards: ID=R1
    resources: tmpdir=/tmp


		fastqc ../sub-reads/R1_R1.fq.gz ../sub-reads/R1_R2.fq.gz -t 2 -q
		

[Thu Jul 22 16:42:13 2021]
rule raw_fastqc:
    input: ../sub-reads/R5_R1.fq.gz, ../sub-reads/R5_R2.fq.gz
    output: ../sub-reads/R5_R1_fastqc.zip, ../sub-reads/R5_R2_fastqc.zip
    jobid: 32
    wildcards: ID=R5
    resources: tmpdir=/tmp


		fastqc ../sub-reads/R5_R1.fq.gz ../sub-reads/R5_R2.fq.gz -t 2 -q
		

[Thu Jul 22 16:42:13 2021]
rule bbduk:
    input: ../sub-reads/R2_R1.fq.gz, ../sub-reads/R2_R2.fq.gz
    output: ../filtered-reads/R2-R1-trimmed.fq.gz, ../filtered-reads/R2-R2-trimmed.fq.gz
    log: logs/bbduk-R2.log
    jobid: 8
    wildcards: ID=R2
    resources: tmpdir=/tmp


        bbduk.sh in=../sub-reads/R2_R1.fq.gz in2=../sub-reads/R2_R2.fq.gz out1=../filtered-reads/R2-R1-trimmed.fq.gz out2=../filtered-reads/R2-R2-trimmed.fq.gz                 ref=${CONDA_PREFIX}/opt/bbmap-38.86-0/resources/adapters.fa ktrim=l k=17 ftm=5 qtrim=rl                 trimq=10 mlf=0.5 maxns=0 > logs/bbduk-R2.log 2>&1
        

[Thu Jul 22 16:42:13 2021]
rule bbduk:
    input: ../sub-reads/R6_R1.fq.gz, ../sub-reads/R6_R2.fq.gz
    output: ../filtered-reads/R6-R1-trimmed.fq.gz, ../filtered-reads/R6-R2-trimmed.fq.gz
    log: logs/bbduk-R6.log
    jobid: 22
    wildcards: ID=R6
    resources: tmpdir=/tmp


        bbduk.sh in=../sub-reads/R6_R1.fq.gz in2=../sub-reads/R6_R2.fq.gz out1=../filtered-reads/R6-R1-trimmed.fq.gz out2=../filtered-reads/R6-R2-trimmed.fq.gz                 ref=${CONDA_PREFIX}/opt/bbmap-38.86-0/resources/adapters.fa ktrim=l k=17 ftm=5 qtrim=rl                 trimq=10 mlf=0.5 maxns=0 > logs/bbduk-R6.log 2>&1
        

[Thu Jul 22 16:42:13 2021]
rule setup_KoFamScan_db:
    output: /home/mdlee4/ref-dbs/kofamscan_db/KO_DB_SETUP
    log: logs/setup-kofamscan-db.log
    jobid: 13
    resources: tmpdir=/tmp


        mkdir -p /home/mdlee4/ref-dbs/kofamscan_db

        curl -L -o /home/mdlee4/ref-dbs/kofamscan_db/ko_list.gz ftp://ftp.genome.jp/pub/db/kofam/ko_list.gz > logs/setup-kofamscan-db.log 2>&1
        curl -L -o /home/mdlee4/ref-dbs/kofamscan_db/profiles.tar.gz ftp://ftp.genome.jp/pub/db/kofam/profiles.tar.gz > logs/setup-kofamscan-db.log 2>&1
        tar -xzf /home/mdlee4/ref-dbs/kofamscan_db/profiles.tar.gz -C /home/mdlee4/ref-dbs/kofamscan_db > logs/setup-kofamscan-db.log 2>&1
        gunzip /home/mdlee4/ref-dbs/kofamscan_db/ko_list.gz

        touch /home/mdlee4/ref-dbs/kofamscan_db/KO_DB_SETUP
        

[Thu Jul 22 16:42:13 2021]
rule setup_CAT_db:
    output: /home/mdlee4/ref-dbs/CAT_prepare_20201123/CAT_DB_SETUP
    log: logs/setup-CAT-db.log
    jobid: 15
    resources: tmpdir=/tmp


        mkdir -p /home/mdlee4/ref-dbs/

        curl -L -o /home/mdlee4/ref-dbs/CAT_prepare_20200618.tar.gz https://tbb.bio.uu.nl/bastiaan/CAT_prepare/CAT_prepare_20201123.tar.gz > logs/setup-CAT-db.log 2>&1
        tar -xvzf /home/mdlee4/ref-dbs/CAT_prepare_20200618.tar.gz -C /home/mdlee4/ref-dbs/ > logs/setup-CAT-db.log 2>&1
        rm /home/mdlee4/ref-dbs/CAT_prepare_20200618.tar.gz

        touch /home/mdlee4/ref-dbs/CAT_prepare_20201123/CAT_DB_SETUP
        

[Thu Jul 22 16:42:13 2021]
rule raw_fastqc:
    input: ../sub-reads/R2_R1.fq.gz, ../sub-reads/R2_R2.fq.gz
    output: ../sub-reads/R2_R1_fastqc.zip, ../sub-reads/R2_R2_fastqc.zip
    jobid: 31
    wildcards: ID=R2
    resources: tmpdir=/tmp


		fastqc ../sub-reads/R2_R1.fq.gz ../sub-reads/R2_R2.fq.gz -t 2 -q
		

[Thu Jul 22 16:42:13 2021]
rule raw_fastqc:
    input: ../sub-reads/R6_R1.fq.gz, ../sub-reads/R6_R2.fq.gz
    output: ../sub-reads/R6_R1_fastqc.zip, ../sub-reads/R6_R2_fastqc.zip
    jobid: 33
    wildcards: ID=R6
    resources: tmpdir=/tmp


		fastqc ../sub-reads/R6_R1.fq.gz ../sub-reads/R6_R2.fq.gz -t 2 -q
		

[Thu Jul 22 16:42:13 2021]
rule filtered_fastqc:
    input: ../filtered-reads/R1-R1-trimmed.fq.gz, ../filtered-reads/R1-R2-trimmed.fq.gz
    output: ../filtered-reads/R1-R1-trimmed_fastqc.zip, ../filtered-reads/R1-R2-trimmed_fastqc.zip
    jobid: 35
    wildcards: ID=R1
    resources: tmpdir=/tmp


		fastqc ../filtered-reads/R1-R1-trimmed.fq.gz ../filtered-reads/R1-R2-trimmed.fq.gz -t 2 -q
		

[Thu Jul 22 16:42:13 2021]
rule assembly:
    input: ../filtered-reads/R1-R1-trimmed.fq.gz, ../filtered-reads/R2-R1-trimmed.fq.gz, ../filtered-reads/R1-R2-trimmed.fq.gz, ../filtered-reads/R2-R2-trimmed.fq.gz
    output: ../assemblies/T1_F1_P-coassembly.fa
    log: logs/T1_F1_P-trinity.log
    jobid: 6
    wildcards: group=T1_F1_P
    resources: tmpdir=/tmp


        R1_reads=$(echo ../filtered-reads/R1-R1-trimmed.fq.gz ../filtered-reads/R2-R1-trimmed.fq.gz | tr " " ",")
        R2_reads=$(echo ../filtered-reads/R1-R2-trimmed.fq.gz ../filtered-reads/R2-R2-trimmed.fq.gz | tr " " ",")

        Trinity --seqType fq --max_memory 100G --left ${R1_reads} --right ${R2_reads} --CPU 10 --min_contig_length 500 --output ../assemblies/T1_F1_P-trinity-out --full_cleanup > logs/T1_F1_P-trinity.log 2>&1

        bit-rename-fasta-headers -i ../assemblies/T1_F1_P-trinity-out.Trinity.fasta -w c_T1_F1_P -o ../assemblies/T1_F1_P-coassembly.fa
        rm ../assemblies/T1_F1_P-trinity-out.Trinity.gene_trans_map ../assemblies/T1_F1_P-trinity-out.Trinity.fasta
        

[Thu Jul 22 16:42:13 2021]
rule filtered_fastqc:
    input: ../filtered-reads/R5-R1-trimmed.fq.gz, ../filtered-reads/R5-R2-trimmed.fq.gz
    output: ../filtered-reads/R5-R1-trimmed_fastqc.zip, ../filtered-reads/R5-R2-trimmed_fastqc.zip
    jobid: 37
    wildcards: ID=R5
    resources: tmpdir=/tmp


		fastqc ../filtered-reads/R5-R1-trimmed.fq.gz ../filtered-reads/R5-R2-trimmed.fq.gz -t 2 -q
		

[Thu Jul 22 16:42:13 2021]
rule filtered_fastqc:
    input: ../filtered-reads/R2-R1-trimmed.fq.gz, ../filtered-reads/R2-R2-trimmed.fq.gz
    output: ../filtered-reads/R2-R1-trimmed_fastqc.zip, ../filtered-reads/R2-R2-trimmed_fastqc.zip
    jobid: 36
    wildcards: ID=R2
    resources: tmpdir=/tmp


		fastqc ../filtered-reads/R2-R1-trimmed.fq.gz ../filtered-reads/R2-R2-trimmed.fq.gz -t 2 -q
		

[Thu Jul 22 16:42:13 2021]
rule filtered_fastqc:
    input: ../filtered-reads/R6-R1-trimmed.fq.gz, ../filtered-reads/R6-R2-trimmed.fq.gz
    output: ../filtered-reads/R6-R1-trimmed_fastqc.zip, ../filtered-reads/R6-R2-trimmed_fastqc.zip
    jobid: 38
    wildcards: ID=R6
    resources: tmpdir=/tmp


		fastqc ../filtered-reads/R6-R1-trimmed.fq.gz ../filtered-reads/R6-R2-trimmed.fq.gz -t 2 -q
		

[Thu Jul 22 16:42:13 2021]
rule raw_multiqc:
    input: ../sub-reads/R1_R1_fastqc.zip, ../sub-reads/R2_R1_fastqc.zip, ../sub-reads/R5_R1_fastqc.zip, ../sub-reads/R6_R1_fastqc.zip, ../sub-reads/R1_R2_fastqc.zip, ../sub-reads/R2_R2_fastqc.zip, ../sub-reads/R5_R2_fastqc.zip, ../sub-reads/R6_R2_fastqc.zip
    output: ../fastqc-outputs/raw_multiqc.html, ../fastqc-outputs/raw_multiqc_data.zip
    jobid: 29
    resources: tmpdir=/tmp


        multiqc -z -q -o ../fastqc-outputs/ -n raw_multiqc ../sub-reads/ > /dev/null 2>&1
          # removing the individual fastqc files
        rm -rf ../sub-reads/*fastqc*
        

[Thu Jul 22 16:42:13 2021]
rule assembly:
    input: ../filtered-reads/R5-R1-trimmed.fq.gz, ../filtered-reads/R6-R1-trimmed.fq.gz, ../filtered-reads/R5-R2-trimmed.fq.gz, ../filtered-reads/R6-R2-trimmed.fq.gz
    output: ../assemblies/T1_F2_N-coassembly.fa
    log: logs/T1_F2_N-trinity.log
    jobid: 20
    wildcards: group=T1_F2_N
    resources: tmpdir=/tmp


        R1_reads=$(echo ../filtered-reads/R5-R1-trimmed.fq.gz ../filtered-reads/R6-R1-trimmed.fq.gz | tr " " ",")
        R2_reads=$(echo ../filtered-reads/R5-R2-trimmed.fq.gz ../filtered-reads/R6-R2-trimmed.fq.gz | tr " " ",")

        Trinity --seqType fq --max_memory 100G --left ${R1_reads} --right ${R2_reads} --CPU 10 --min_contig_length 500 --output ../assemblies/T1_F2_N-trinity-out --full_cleanup > logs/T1_F2_N-trinity.log 2>&1

        bit-rename-fasta-headers -i ../assemblies/T1_F2_N-trinity-out.Trinity.fasta -w c_T1_F2_N -o ../assemblies/T1_F2_N-coassembly.fa
        rm ../assemblies/T1_F2_N-trinity-out.Trinity.gene_trans_map ../assemblies/T1_F2_N-trinity-out.Trinity.fasta
        

[Thu Jul 22 16:42:13 2021]
rule call_genes:
    input: ../assemblies/T1_F1_P-coassembly.fa
    output: ../predicted-genes/T1_F1_P-genes.faa, ../predicted-genes/T1_F1_P-genes.fa, ../predicted-genes/T1_F1_P-genes.gff
    log: logs/T1_F1_P-prodigal.log
    jobid: 9
    wildcards: group=T1_F1_P
    resources: tmpdir=/tmp


        prodigal -q -c -p meta -a ../predicted-genes/T1_F1_P-genes.faa -d ../predicted-genes/T1_F1_P-genes.fa -f gff -o ../predicted-genes/T1_F1_P-genes.gff -i ../assemblies/T1_F1_P-coassembly.fa > logs/T1_F1_P-prodigal.log 2>&1
        

[Thu Jul 22 16:42:13 2021]
rule call_genes:
    input: ../assemblies/T1_F2_N-coassembly.fa
    output: ../predicted-genes/T1_F2_N-genes.faa, ../predicted-genes/T1_F2_N-genes.fa, ../predicted-genes/T1_F2_N-genes.gff
    log: logs/T1_F2_N-prodigal.log
    jobid: 23
    wildcards: group=T1_F2_N
    resources: tmpdir=/tmp


        prodigal -q -c -p meta -a ../predicted-genes/T1_F2_N-genes.faa -d ../predicted-genes/T1_F2_N-genes.fa -f gff -o ../predicted-genes/T1_F2_N-genes.gff -i ../assemblies/T1_F2_N-coassembly.fa > logs/T1_F2_N-prodigal.log 2>&1
        

[Thu Jul 22 16:42:13 2021]
rule summarize_assemblies:
    input: ../assemblies/T1_F1_P-coassembly.fa, ../assemblies/T1_F2_N-coassembly.fa
    output: ../assemblies/assembly-summaries.tsv
    jobid: 28
    resources: tmpdir=/tmp


        bit-summarize-assembly -o ../assemblies/assembly-summaries.tsv ../assemblies/T1_F1_P-coassembly.fa ../assemblies/T1_F2_N-coassembly.fa
        

[Thu Jul 22 16:42:13 2021]
rule build_bowtie2_index:
    input: ../assemblies/T1_F1_P-coassembly.fa
    output: ../read-mapping/T1_F1_P-bowtie2-build.log
    jobid: 5
    wildcards: group=T1_F1_P
    resources: tmpdir=/tmp


        bowtie2-build ../assemblies/T1_F1_P-coassembly.fa ../read-mapping/T1_F1_P-index > ../read-mapping/T1_F1_P-bowtie2-build.log 2>&1
        

[Thu Jul 22 16:42:13 2021]
rule build_bowtie2_index:
    input: ../assemblies/T1_F2_N-coassembly.fa
    output: ../read-mapping/T1_F2_N-bowtie2-build.log
    jobid: 19
    wildcards: group=T1_F2_N
    resources: tmpdir=/tmp


        bowtie2-build ../assemblies/T1_F2_N-coassembly.fa ../read-mapping/T1_F2_N-index > ../read-mapping/T1_F2_N-bowtie2-build.log 2>&1
        

[Thu Jul 22 16:42:13 2021]
rule filtered_multiqc:
    input: ../filtered-reads/R1-R1-trimmed_fastqc.zip, ../filtered-reads/R2-R1-trimmed_fastqc.zip, ../filtered-reads/R5-R1-trimmed_fastqc.zip, ../filtered-reads/R6-R1-trimmed_fastqc.zip, ../filtered-reads/R1-R2-trimmed_fastqc.zip, ../filtered-reads/R2-R2-trimmed_fastqc.zip, ../filtered-reads/R5-R2-trimmed_fastqc.zip, ../filtered-reads/R6-R2-trimmed_fastqc.zip
    output: ../fastqc-outputs/filtered_multiqc.html, ../fastqc-outputs/filtered_multiqc_data.zip
    jobid: 34
    resources: tmpdir=/tmp


        multiqc -z -q -o ../fastqc-outputs/ -n filtered_multiqc  ../filtered-reads/ > /dev/null 2>&1
          # removing the individual fastqc files and temp locations
        rm -rf ../filtered-reads/*fastqc*
        

[Thu Jul 22 16:42:13 2021]
rule run_KO_annotation:
    input: ../predicted-genes/T1_F2_N-genes.faa, /home/mdlee4/ref-dbs/kofamscan_db/KO_DB_SETUP
    output: ../annotations-and-taxonomy/T1_F2_N-annotations.tsv
    log: logs/T1_F2_N-kofamscan.log
    jobid: 26
    wildcards: group=T1_F2_N
    resources: tmpdir=/tmp


        exec_annotation -p /home/mdlee4/ref-dbs/kofamscan_db/profiles/ -k /home/mdlee4/ref-dbs/kofamscan_db/ko_list --cpu 10 -f detail-tsv -o ../annotations-and-taxonomy/T1_F2_N-KO-tab.tmp --tmp-dir ../annotations-and-taxonomy/T1_F2_N-tmp-KO-dir --report-unannotated ../predicted-genes/T1_F2_N-genes.faa > logs/T1_F2_N-kofamscan.log 2>&1

        bit-filter-KOFamScan-results -i ../annotations-and-taxonomy/T1_F2_N-KO-tab.tmp -o ../annotations-and-taxonomy/T1_F2_N-annotations.tsv

        rm -rf ../annotations-and-taxonomy/T1_F2_N-KO-tab.tmp ../annotations-and-taxonomy/T1_F2_N-tmp-KO-dir
        

[Thu Jul 22 16:42:13 2021]
rule run_KO_annotation:
    input: ../predicted-genes/T1_F1_P-genes.faa, /home/mdlee4/ref-dbs/kofamscan_db/KO_DB_SETUP
    output: ../annotations-and-taxonomy/T1_F1_P-annotations.tsv
    log: logs/T1_F1_P-kofamscan.log
    jobid: 12
    wildcards: group=T1_F1_P
    resources: tmpdir=/tmp


        exec_annotation -p /home/mdlee4/ref-dbs/kofamscan_db/profiles/ -k /home/mdlee4/ref-dbs/kofamscan_db/ko_list --cpu 10 -f detail-tsv -o ../annotations-and-taxonomy/T1_F1_P-KO-tab.tmp --tmp-dir ../annotations-and-taxonomy/T1_F1_P-tmp-KO-dir --report-unannotated ../predicted-genes/T1_F1_P-genes.faa > logs/T1_F1_P-kofamscan.log 2>&1

        bit-filter-KOFamScan-results -i ../annotations-and-taxonomy/T1_F1_P-KO-tab.tmp -o ../annotations-and-taxonomy/T1_F1_P-annotations.tsv

        rm -rf ../annotations-and-taxonomy/T1_F1_P-KO-tab.tmp ../annotations-and-taxonomy/T1_F1_P-tmp-KO-dir
        

[Thu Jul 22 16:42:13 2021]
rule run_tax_classification:
    input: ../assemblies/T1_F1_P-coassembly.fa, ../predicted-genes/T1_F1_P-genes.faa, /home/mdlee4/ref-dbs/CAT_prepare_20201123/CAT_DB_SETUP
    output: ../annotations-and-taxonomy/T1_F1_P-gene-tax.tsv, ../annotations-and-taxonomy/T1_F1_P-transcript-tax.tsv
    log: logs/T1_F1_P-CAT.log
    jobid: 14
    wildcards: group=T1_F1_P
    resources: tmpdir=/tmp

RuleException in line 210 of /mnt/data/Bebout_lab/N-project-metatranscriptomes/sandbox/workflow/Snakefile:
'Params' object has no attribute 'tmp_contigs'
